<div class="postListPage">
    <div class="postsContainer">
        <ul class="postList">
            <% @following.each do |following| %>
                <% user = User.find_by(id: following.following_id) %>
                <% posts = Post.where(user_id: user.id) %>
                <% posts.each do |post| %>
                    <li class="postItem">
                        <p class="postAuthor"><%= link_to post.user.username, "/users/#{post.user.id}" %></p>
                        <p class="date"><%= post.created_at.strftime('%Y/%m/%d %H:%M') %></p>
                        <div class="postBody">
                            <%= post.content %>
                        </div>

                        <div class="postBottom">
                            <% likes_count = Like.where(post_id: post.id).count %>
                            <% if Like.find_by(user_id: @current_user.id, post_id: post.id) %>
                                <%= link_to dislikes_in_home_path(post.id), data: { turbo_method: :delete} do%>
                                    <div class="likes"><i class="fa-solid fa-heart like"></i><span><%= likes_count %></span></div>
                                <% end %>
                            <% else %>
                                <%= link_to  likes_in_home_path(post.id), data: { turbo_method: :post } do %>
                                    <div class="likes"><i class="fa-solid fa-heart unlike"></i><span><%= likes_count %></span></div>
                                <% end %>
                            <% end %>
                            <% if @current_user.id == post.user_id %>
                                <div class="buttons">
                                    <%= link_to("編集", "/posts/#{post.id}/edit", class: "editBtn") %>
                                    <%= button_to "削除", "/posts/#{post.id}/delete", method: :post, class: "deleteBtn" %>
                                </div>
                            <% end %>
                        </div>
                    </li>
                <% end %>
            <% end %>
        </ul>
    </div>
</div>
